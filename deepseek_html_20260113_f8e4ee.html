<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<meta name="description" content="Ù…Ù†ØµØ© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¨Ø³ÙŠØ·Ø© - Ø¥ÙƒÙ…Ø§Ù„ Ù…Ù‡Ø§Ù… Ø¨Ø³ÙŠØ·Ø© ÙˆÙƒØ³Ø¨ Ø§Ù„Ù…Ø§Ù„">
<meta name="keywords" content="Ù…Ù‡Ø§Ù…, ÙƒØ³Ø¨ Ø§Ù„Ù…Ø§Ù„, Ø±Ø¨Ø­ Ù…Ù† Ø§Ù„Ø§Ù†ØªØ±Ù†Øª, Ù…Ù‡Ø§Ù… Ø¨Ø³ÙŠØ·Ø©">
<title>Ù…Ù†ØµØ© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¨Ø³ÙŠØ·Ø© - Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ±Ø¨Ø­ Ø§Ù„Ù…Ø§Ù„</title>
<style>
/* ØªØ­Ø³ÙŠÙ†Ø§Øª CSS Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Arial', sans-serif;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    line-height: 1.6;
    color: #333;
    min-height: 100vh;
}

.container {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    padding: 30px;
    margin-bottom: 30px;
}

h1, h2, h3 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
}

h1 {
    background: linear-gradient(to right, #3498db, #2ecc71);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    padding: 10px;
    font-size: 2.5em;
    margin-bottom: 30px;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
.auth-form {
    max-width: 400px;
    margin: 0 auto;
    padding: 25px;
    background: #f8f9fa;
    border-radius: 10px;
    border: 1px solid #e9ecef;
}

input, select, button {
    margin: 10px 0;
    padding: 12px 15px;
    width: 100%;
    box-sizing: border-box;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
}

input, select {
    border: 2px solid #ddd;
    background: white;
}

input:focus, select:focus {
    border-color: #3498db;
    outline: none;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

button {
    cursor: pointer;
    border: none;
    font-weight: bold;
    transition: all 0.3s ease;
}

.btn-primary {
    background: linear-gradient(to right, #3498db, #2980b9);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(to right, #2980b9, #1c5a7a);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
}

.btn-success {
    background: linear-gradient(to right, #2ecc71, #27ae60);
    color: white;
}

.btn-success:hover {
    background: linear-gradient(to right, #27ae60, #219653);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
}

.btn-google {
    background: linear-gradient(to right, #db4437, #c33d2e);
    color: white;
}

.btn-google:hover {
    background: linear-gradient(to right, #c33d2e, #a83429);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(219, 68, 55, 0.3);
}

.btn-danger {
    background: linear-gradient(to right, #e74c3c, #c0392b);
    color: white;
}

.btn-danger:hover {
    background: linear-gradient(to right, #c0392b, #a93226);
    transform: translateY(-2px);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
.task, .admin-box, .user-card {
    border: 1px solid #ddd;
    padding: 20px;
    margin: 15px 0;
    background: white;
    border-radius: 12px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.task:hover, .admin-box:hover, .user-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    border-color: #3498db;
}

.task::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 5px;
    background: linear-gradient(to bottom, #3498db, #2ecc71);
}

.task h4 {
    color: #2c3e50;
    margin-bottom: 10px;
    font-size: 1.2em;
}

.task-reward {
    background: #f8f9fa;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: bold;
    color: #27ae60;
    display: inline-block;
    margin: 10px 0;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
.admin-section, .user-section {
    display: none;
    margin-top: 30px;
}

.section-title {
    background: linear-gradient(to right, #f8f9fa, #e9ecef);
    padding: 15px;
    border-radius: 10px;
    margin: 20px 0;
    border-right: 5px solid #3498db;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
.success {
    color: #27ae60;
    background: #d5f4e6;
    padding: 12px;
    border-radius: 8px;
    border-right: 4px solid #27ae60;
    margin: 10px 0;
}

.error {
    color: #e74c3c;
    background: #fadbd8;
    padding: 12px;
    border-radius: 8px;
    border-right: 4px solid #e74c3c;
    margin: 10px 0;
}

.info {
    color: #3498db;
    background: #d6eaf8;
    padding: 12px;
    border-radius: 8px;
    border-right: 4px solid #3498db;
    margin: 10px 0;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªÙˆØ§Ø²Ù† */
.balance-container {
    background: linear-gradient(135deg, #3498db, #2ecc71);
    color: white;
    padding: 25px;
    border-radius: 15px;
    text-align: center;
    margin: 20px 0;
    box-shadow: 0 10px 20px rgba(52, 152, 219, 0.2);
}

.balance-amount {
    font-size: 3em;
    font-weight: bold;
    margin: 10px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
.task-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.task-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.task-actions button {
    flex: 1;
    padding: 10px;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
.admin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-top: 5px solid #3498db;
}

.stat-number {
    font-size: 2.5em;
    font-weight: bold;
    color: #2c3e50;
    margin: 10px 0;
}

.stat-label {
    color: #7f8c8d;
    font-size: 0.9em;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª */
.adsense-container {
    margin: 30px 0;
    text-align: center;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    border: 2px dashed #bdc3c7;
}

.adsense-placeholder {
    width: 100%;
    height: 280px;
    background: linear-gradient(45deg, #f1f2f6 25%, #dfe4ea 25%, #dfe4ea 50%, #f1f2f6 50%, #f1f2f6 75%, #dfe4ea 75%);
    background-size: 50px 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #7f8c8d;
    font-weight: bold;
    border-radius: 8px;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    
    .container {
        padding: 15px;
    }
    
    h1 {
        font-size: 1.8em;
    }
    
    .task-grid, .admin-grid {
        grid-template-columns: 1fr;
    }
    
    .balance-amount {
        font-size: 2em;
    }
    
    .task-actions {
        flex-direction: column;
    }
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø±ÙˆØ§Ø¨Ø· */
.referral-link {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    margin: 15px 0;
    border: 2px solid #3498db;
    word-break: break-all;
}

.referral-code {
    font-family: monospace;
    background: #2c3e50;
    color: white;
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
    display: inline-block;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ */
.nav-tabs {
    display: flex;
    justify-content: center;
    margin: 20px 0;
    border-bottom: 2px solid #eee;
}

.nav-tab {
    padding: 12px 25px;
    margin: 0 5px;
    cursor: pointer;
    border-radius: 8px 8px 0 0;
    background: #f8f9fa;
    border: 1px solid #eee;
    border-bottom: none;
    transition: all 0.3s ease;
}

.nav-tab.active {
    background: white;
    border-color: #3498db;
    color: #3498db;
    font-weight: bold;
    position: relative;
    top: 2px;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #2c3e50;
}

/* Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… */
.progress-bar {
    width: 100%;
    height: 10px;
    background: #ecf0f1;
    border-radius: 5px;
    overflow: hidden;
    margin: 10px 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(to right, #2ecc71, #3498db);
    border-radius: 5px;
    transition: width 0.3s ease;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙˆÙ‚Øª */
.timestamp {
    font-size: 0.8em;
    color: #95a5a6;
    margin-top: 5px;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª */
.badge {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: bold;
    margin-left: 10px;
}

.badge-success {
    background: #d5f4e6;
    color: #27ae60;
}

.badge-warning {
    background: #fef5e7;
    color: #f39c12;
}

.badge-danger {
    background: #fadbd8;
    color: #e74c3c;
}
</style>
</head>
<body>
<div class="container">
    <h1>ğŸš€ Ù…Ù†ØµØ© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¨Ø³ÙŠØ·Ø© - Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ±Ø¨Ø­ Ø§Ù„Ù…Ø§Ù„</h1>
    
    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
    <div id="auth-section" class="auth-section">
        <div class="auth-form">
            <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            
            <div class="form-group">
                <label class="form-label" for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="email" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)" minlength="6" required>
            </div>
            
            <div class="form-group">
                <button id="signup" class="btn-success">ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
                <button id="login" class="btn-primary">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button id="google-login" class="btn-google">ğŸ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google</button>
            </div>
            
            <div id="auth-msg" class="message"></div>
            
            <div class="info" style="margin-top: 20px;">
                <strong>ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ ÙÙˆØ±Ø§Ù‹ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆÙƒØ³Ø¨ Ø§Ù„Ù…Ø§Ù„!
            </div>
        </div>
    </div>
    
    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div class="user-section" id="user-section">
        <div class="user-header">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="user-email" style="color: #3498db;"></span> ğŸ‘‹</h2>
            
            <div class="balance-container">
                <h3>ğŸ’° Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                <div class="balance-amount">$<span id="balance">0</span></div>
                <p>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨: $25</p>
            </div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showUserTab('tasks')">ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©</div>
            <div class="nav-tab" onclick="showUserTab('withdraw')">ğŸ’³ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</div>
            <div class="nav-tab" onclick="showUserTab('referral')">ğŸ‘¥ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</div>
            <div class="nav-tab" onclick="showUserTab('profile')">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù‡Ø§Ù… -->
        <div id="user-tasks-tab" class="user-tab active">
            <h3 class="section-title">ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ØªÙ†ÙÙŠØ°</h3>
            <div id="tasks" class="task-grid"></div>
            <div id="tasks-msg" class="message"></div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ø­Ø¨ -->
        <div id="user-withdraw-tab" class="user-tab">
            <h3 class="section-title">ğŸ’³ Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</h3>
            
            <div class="form-group">
                <label class="form-label" for="paypal">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø­Ø³Ø§Ø¨ PayPal</label>
                <input type="email" id="paypal" placeholder="paypal@example.com" required>
                <small style="color: #7f8c8d;">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø¥Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø©</small>
            </div>
            
            <div class="form-group">
                <button id="withdraw" class="btn-success">ğŸ’° ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨</button>
            </div>
            
            <div id="withdraw-history">
                <h4>ğŸ“‹ ØªØ§Ø±ÙŠØ® Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</h4>
                <div id="user-withdrawals"></div>
            </div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© -->
        <div id="user-referral-tab" class="user-tab">
            <h3 class="section-title">ğŸ‘¥ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø© - Ø§ÙƒØ³Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯!</h3>
            
            <div class="referral-stats">
                <div class="stat-card">
                    <div class="stat-number" id="referral-count">0</div>
                    <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ø£Ø­Ù„ØªÙ‡Ù…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="referral-earnings">$0</div>
                    <div class="stat-label">Ø£Ø±Ø¨Ø§Ø­Ùƒ Ù…Ù† Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</label>
                <div class="referral-link">
                    <span id="user-referral-link">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                    <button onclick="copyReferralLink()" class="btn-primary" style="margin-top: 10px; width: auto;">ğŸ“‹ Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="referral">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø±Ø§Ø¨Ø· Ø¥Ø­Ø§Ù„Ø© Ù…Ù† ØµØ¯ÙŠÙ‚ØŸ</label>
                <input type="text" id="referral" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù…Ù† ØµØ¯ÙŠÙ‚Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <button id="add-referral" class="btn-success">ğŸ ØªÙØ¹ÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</button>
            </div>
            
            <div class="info">
                <strong>ğŸ¯ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø©:</strong><br>
                1. Ø´Ø§Ø±Ùƒ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ<br>
                2. Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ³Ø¬Ù„ ØµØ¯ÙŠÙ‚Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø·ÙƒØŒ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ 10% Ù…Ù† Ø£Ø±Ø¨Ø§Ø­Ù‡<br>
                3. Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª
            </div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
        <div id="user-profile-tab" class="user-tab">
            <h3 class="section-title">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
            
            <div class="profile-info">
                <div class="stat-card">
                    <div class="stat-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
                    <div class="stat-number" id="join-date">-</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>
                    <div class="stat-number" id="completed-tasks">0</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div>
                    <div class="stat-number" id="total-earnings">$0</div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button id="logout" class="btn-danger">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>
        
        <div id="user-msg" class="message"></div>
    </div>
    
    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
    <div class="admin-section" id="admin-section">
        <h2>ğŸ‘‘ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
        
        <!-- Ø¹Ù„Ø§Ù…Ø§Øª ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showAdminTab('stats')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
            <div class="nav-tab" onclick="showAdminTab('tasks')">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</div>
            <div class="nav-tab" onclick="showAdminTab('withdrawals')">ğŸ’³ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</div>
            <div class="nav-tab" onclick="showAdminTab('users')">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div id="admin-stats-tab" class="admin-tab active">
            <h3 class="section-title">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØµØ©</h3>
            
            <div class="admin-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-users">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number" id="active-tasks-count">0</div>
                    <div class="stat-label">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number" id="pending-withdrawals">0</div>
                    <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number" id="total-earned">$0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ²Ø¹Ø©</div>
                </div>
            </div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… -->
        <div id="admin-tasks-tab" class="admin-tab">
            <h3 class="section-title">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            
            <div class="admin-form">
                <div class="form-group">
                    <label class="form-label" for="task-title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                    <input type="text" id="task-title" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠØ¯ÙŠÙˆ Ø¹Ù„Ù‰ YouTube">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="task-url">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                    <input type="url" id="task-url" placeholder="https://example.com/task">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="task-reward">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© ($)</label>
                    <input type="number" id="task-reward" placeholder="0.50" step="0.01" min="0.01">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="task-max">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</label>
                    <input type="number" id="task-max" placeholder="100" min="1">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="task-type">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                    <select id="task-type">
                        <option value="visit">Ø²ÙŠØ§Ø±Ø© Ù…ÙˆÙ‚Ø¹</option>
                        <option value="watch">Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠØ¯ÙŠÙˆ</option>
                        <option value="survey">Ø§Ø³ØªØ¨ÙŠØ§Ù†</option>
                        <option value="signup">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</option>
                    </select>
                </div>
                
                <button id="add-task" class="btn-success">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©</button>
            </div>
            
            <h3 class="section-title">ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
            <div id="admin-tasks" class="task-grid"></div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ -->
        <div id="admin-withdrawals-tab" class="admin-tab">
            <h3 class="section-title">ğŸ’³ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h3>
            <div id="withdrawals"></div>
            
            <h3 class="section-title" style="margin-top: 30px;">âœ… Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>
            <div id="completed-withdrawals"></div>
        </div>
        
        <!-- Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <div id="admin-users-tab" class="admin-tab">
            <h3 class="section-title">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
            
            <div class="form-group">
                <input type="text" id="search-user" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" onkeyup="searchUsers()">
            </div>
            
            <div id="users-list"></div>
        </div>
    </div>
</div>

<!-- Ù…ÙƒØ§Ù† AdSense -->
<div class="container">
    <div class="adsense-container">
        <h3>ğŸ¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>
        <div class="adsense-placeholder">
            Ù…Ø³Ø§Ø­Ø© Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª AdSense
            <div style="margin-top: 10px; font-size: 0.8em;">
                (Ø¶Ø¹ ÙƒÙˆØ¯ AdSense Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§)
            </div>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, addDoc, updateDoc, query, where, getDocs, increment, Timestamp, orderBy, limit, deleteDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

// Firebase Config - Ù†ÙØ³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
const firebaseConfig = {
  apiKey: "AIzaSyBi8QAvoffMy0LWVdQaWKpAu1XPhOc2RTI",
  authDomain: "adel-a0800.firebaseapp.com",
  projectId: "adel-a0800",
  storageBucket: "adel-a0800.firebasestorage.app",
  messagingSenderId: "476049285056",
  appId: "1:476049285056:web:bb951d3b9c927bd08f7225",
  measurementId: "G-33YZL9E1KK"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
const adminEmail = "a13466883@gmail.com";

// DOM Elements
const authSection = document.getElementById('auth-section');
const userSection = document.getElementById('user-section');
const adminSection = document.getElementById('admin-section');
const userEmailEl = document.getElementById('user-email');
const balanceEl = document.getElementById('balance');
const tasksDiv = document.getElementById('tasks');
const authMsg = document.getElementById('auth-msg');
const userMsg = document.getElementById('user-msg');
const adminTasksDiv = document.getElementById('admin-tasks');
const withdrawalsDiv = document.getElementById('withdrawals');
const usersListDiv = document.getElementById('users-list');

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}

function validatePassword(password) {
    return password.length >= 6;
}

function showMessage(element, message, type = 'info') {
    element.innerHTML = `<div class="${type}">${message}</div>`;
    setTimeout(() => {
        element.innerHTML = '';
    }, 5000);
}

// ======== AUTH ========
document.getElementById('signup').onclick = async () => {
    authMsg.textContent = "";
    try {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!validateEmail(email)) {
            showMessage(authMsg, "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­", 'error');
            return;
        }
        
        if (!validatePassword(password)) {
            showMessage(authMsg, "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", 'error');
            return;
        }
        
        showMessage(authMsg, "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...", 'info');
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        currentUser = userCredential.user;
        
        await setDoc(doc(db, 'users', currentUser.uid), {
            email: email,
            balance: 0,
            referrals: 0,
            referralEarnings: 0,
            referredBy: null,
            completedTasks: 0,
            totalEarnings: 0,
            paidSkip: false,
            createdAt: Timestamp.now(),
            lastLogin: Timestamp.now()
        });
        
        logEvent(analytics, 'sign_up', { method: 'email' });
        showMessage(authMsg, "ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¢Ù†.", 'success');
        
    } catch (e) {
        console.error(e);
        if (e.code === 'auth/email-already-in-use') {
            showMessage(authMsg, "Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„", 'error');
        } else {
            showMessage(authMsg, e.message, 'error');
        }
    }
};

document.getElementById('login').onclick = async () => {
    authMsg.textContent = "";
    try {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!validateEmail(email)) {
            showMessage(authMsg, "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­", 'error');
            return;
        }
        
        showMessage(authMsg, "Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...", 'info');
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        currentUser = userCredential.user;
        
        logEvent(analytics, 'login', { method: 'email' });
        
    } catch (e) {
        console.error(e);
        if (e.code === 'auth/user-not-found' || e.code === 'auth/wrong-password') {
            showMessage(authMsg, "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©", 'error');
        } else {
            showMessage(authMsg, e.message, 'error');
        }
    }
};

document.getElementById('google-login').onclick = async () => {
    const provider = new GoogleAuthProvider();
    provider.setCustomParameters({
        prompt: 'select_account'
    });
    
    try {
        showMessage(authMsg, "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Google...", 'info');
        const userCredential = await signInWithPopup(auth, provider);
        currentUser = userCredential.user;
        
        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
        if (!userDoc.exists()) {
            await setDoc(doc(db, 'users', currentUser.uid), {
                email: currentUser.email,
                balance: 0,
                referrals: 0,
                referralEarnings: 0,
                referredBy: null,
                completedTasks: 0,
                totalEarnings: 0,
                paidSkip: false,
                createdAt: Timestamp.now(),
                lastLogin: Timestamp.now()
            });
        } else {
            await updateDoc(doc(db, 'users', currentUser.uid), {
                lastLogin: Timestamp.now()
            });
        }
        
        logEvent(analytics, 'login', { method: 'google' });
        
    } catch (e) {
        console.error(e);
        showMessage(authMsg, e.message, 'error');
    }
};

document.getElementById('logout').onclick = async () => {
    try {
        await signOut(auth);
        currentUser = null;
        authSection.style.display = 'block';
        userSection.style.display = 'none';
        adminSection.style.display = 'none';
        logEvent(analytics, 'logout');
    } catch (e) {
        console.error(e);
    }
};

// ======== AUTH STATE ========
onAuthStateChanged(auth, async user => {
    if (user) {
        currentUser = user;
        await updateDoc(doc(db, 'users', currentUser.uid), {
            lastLogin: Timestamp.now()
        });
        showInterface();
    } else {
        authSection.style.display = 'block';
        userSection.style.display = 'none';
        adminSection.style.display = 'none';
    }
});

// ======== SHOW INTERFACE ========
async function showInterface() {
    authSection.style.display = 'none';
    userEmailEl.textContent = currentUser.email;
    
    if (currentUser.email === adminEmail) {
        adminSection.style.display = 'block';
        userSection.style.display = 'none';
        await loadAdminData();
        showAdminTab('stats');
    } else {
        userSection.style.display = 'block';
        adminSection.style.display = 'none';
        await loadUserData();
        showUserTab('tasks');
    }
}

// ======== TAB MANAGEMENT ========
function showUserTab(tabName) {
    const tabs = ['tasks', 'withdraw', 'referral', 'profile'];
    const navTabs = document.querySelectorAll('.user-tab');
    const navButtons = document.querySelectorAll('.nav-tab');
    
    tabs.forEach(tab => {
        const element = document.getElementById(`user-${tab}-tab`);
        if (element) {
            element.classList.remove('active');
        }
    });
    
    navButtons.forEach(button => {
        button.classList.remove('active');
    });
    
    document.getElementById(`user-${tabName}-tab`).classList.add('active');
    navButtons[tabs.indexOf(tabName)].classList.add('active');
    
    if (tabName === 'tasks') {
        loadTasks();
    } else if (tabName === 'withdraw') {
        loadUserWithdrawals();
    } else if (tabName === 'referral') {
        loadReferralInfo();
    } else if (tabName === 'profile') {
        loadUserProfile();
    }
}

function showAdminTab(tabName) {
    const tabs = ['stats', 'tasks', 'withdrawals', 'users'];
    const navTabs = document.querySelectorAll('.admin-tab');
    const navButtons = document.querySelectorAll('.nav-tab');
    
    tabs.forEach(tab => {
        const element = document.getElementById(`admin-${tab}-tab`);
        if (element) {
            element.classList.remove('active');
        }
    });
    
    navButtons.forEach(button => {
        button.classList.remove('active');
    });
    
    document.getElementById(`admin-${tabName}-tab`).classList.add('active');
    navButtons[tabs.indexOf(tabName)].classList.add('active');
}

// ======== LOAD USER DATA ========
async function loadUserData() {
    try {
        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
        if (userDoc.exists()) {
            const userData = userDoc.data();
            balanceEl.textContent = userData.balance ? userData.balance.toFixed(2) : '0.00';
            
            // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
            const referralLink = `${window.location.origin}${window.location.pathname}?ref=${currentUser.uid}`;
            document.getElementById('user-referral-link').textContent = referralLink;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            if (document.getElementById('referral-count')) {
                document.getElementById('referral-count').textContent = userData.referrals || 0;
            }
            if (document.getElementById('referral-earnings')) {
                document.getElementById('referral-earnings').textContent = `$${userData.referralEarnings ? userData.referralEarnings.toFixed(2) : '0.00'}`;
            }
            if (document.getElementById('completed-tasks')) {
                document.getElementById('completed-tasks').textContent = userData.completedTasks || 0;
            }
            if (document.getElementById('total-earnings')) {
                document.getElementById('total-earnings').textContent = `$${userData.totalEarnings ? userData.totalEarnings.toFixed(2) : '0.00'}`;
            }
            if (document.getElementById('join-date') && userData.createdAt) {
                const date = userData.createdAt.toDate();
                document.getElementById('join-date').textContent = date.toLocaleDateString('ar-SA');
            }
        }
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
    }
}

async function loadUserProfile() {
    await loadUserData();
}

async function loadReferralInfo() {
    await loadUserData();
}

// ======== TASKS SYSTEM ========
async function loadTasks() {
    try {
        tasksDiv.innerHTML = '<div class="loading" style="text-align:center;padding:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…...</div>';
        const q = query(collection(db, 'tasks'), where('status', '==', 'active'), orderBy('reward', 'desc'));
        const querySnapshot = await getDocs(q);
        
        tasksDiv.innerHTML = '';
        
        if (querySnapshot.empty) {
            tasksDiv.innerHTML = '<div class="info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.</div>';
            return;
        }
        
        querySnapshot.forEach(docSnap => {
            const task = docSnap.data();
            const progressPercent = task.maxUsers > 0 ? (task.completed || 0) / task.maxUsers * 100 : 0;
            
            const div = document.createElement('div');
            div.className = 'task';
            div.innerHTML = `
                <h4>${task.title}</h4>
                <div class="task-reward">ğŸ’° Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©: $${task.reward.toFixed(2)}</div>
                <p>${task.description || 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±ÙÙ‚'}</p>
                ${task.url ? `<p><strong>ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·:</strong> <a href="${task.url}" target="_blank">${task.url.substring(0, 50)}...</a></p>` : ''}
                
                <div class="progress-container" style="margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <small>${task.completed || 0} / ${task.maxUsers} Ù…ÙƒØªÙ…Ù„</small>
                        <small>${progressPercent.toFixed(0)}%</small>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%"></div>
                    </div>
                </div>
                
                <div class="task-actions">
                    <button onclick="viewTask('${docSnap.id}')" class="btn-primary">ğŸ‘€ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
                    <button onclick="completeTask('${docSnap.id}', ${task.reward})" class="btn-success">âœ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
                </div>
                <div class="timestamp">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©: ${task.type || 'Ø²ÙŠØ§Ø±Ø© Ù…ÙˆÙ‚Ø¹'}</div>
            `;
            tasksDiv.appendChild(div);
        });
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…:", error);
        tasksDiv.innerHTML = '<div class="error">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</div>';
    }
}

window.viewTask = async (taskId) => {
    try {
        const taskDoc = await getDoc(doc(db, 'tasks', taskId));
        if (taskDoc.exists()) {
            const task = taskDoc.data();
            if (task.url) {
                window.open(task.url, '_blank');
                logEvent(analytics, 'view_task', { task_id: taskId });
            }
        }
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ù…Ø©:", error);
    }
};

window.completeTask = async (taskId, reward) => {
    if (!currentUser) return alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    
    try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
        const existingSubmission = await getDocs(query(
            collection(db, 'task_submissions'),
            where('taskId', '==', taskId),
            where('userId', '==', currentUser.uid)
        ));
        
        if (!existingSubmission.empty) {
            showMessage(userMsg, "âš ï¸ Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹!", 'error');
            return;
        }
        
        showMessage(userMsg, "â³ Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©...", 'info');
        
        // ØªØ³Ø¬ÙŠÙ„ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
        await addDoc(collection(db, 'task_submissions'), {
            taskId: taskId,
            userId: currentUser.uid,
            reward: reward,
            status: 'completed',
            submittedAt: Timestamp.now(),
            approvedAt: Timestamp.now()
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©
        const taskRef = doc(db, 'tasks', taskId);
        await updateDoc(taskRef, {
            completed: increment(1)
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const userRef = doc(db, 'users', currentUser.uid);
        await updateDoc(userRef, {
            balance: increment(reward),
            completedTasks: increment(1),
            totalEarnings: increment(reward)
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø£Ø­Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const userDoc = await getDoc(userRef);
        const userData = userDoc.data();
        
        if (userData.referredBy) {
            const referralUserRef = doc(db, 'users', userData.referredBy);
            const referralBonus = reward * 0.10; // 10% Ø¹Ù…ÙˆÙ„Ø© Ø¥Ø­Ø§Ù„Ø©
            
            await updateDoc(referralUserRef, {
                balance: increment(referralBonus),
                referralEarnings: increment(referralBonus)
            });
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await loadUserData();
        await loadTasks();
        
        showMessage(userMsg, `ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… Ø¥Ø¶Ø§ÙØ© $${reward.toFixed(2)} Ø¥Ù„Ù‰ Ø±ØµÙŠØ¯Ùƒ.`, 'success');
        logEvent(analytics, 'complete_task', { task_id: taskId, reward: reward });
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", 'error');
    }
};

// ======== REFERRAL SYSTEM ========
async function copyReferralLink() {
    const referralLink = document.getElementById('user-referral-link').textContent;
    try {
        await navigator.clipboard.writeText(referralLink);
        showMessage(userMsg, "âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!", 'success');
    } catch (err) {
        console.error('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·:', err);
        showMessage(userMsg, "âŒ ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·", 'error');
    }
}

document.getElementById('add-referral').onclick = async () => {
    const refCode = document.getElementById('referral').value;
    if (!refCode) {
        showMessage(userMsg, "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø­Ø§Ù„Ø©", 'error');
        return;
    }
    
    try {
        const userRef = doc(db, 'users', currentUser.uid);
        await updateDoc(userRef, { referredBy: refCode });
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø£Ø­Ø§Ù„
        const referrerRef = doc(db, 'users', refCode);
        await updateDoc(referrerRef, { referrals: increment(1) });
        
        showMessage(userMsg, "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ.", 'success');
        await loadUserData();
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©", 'error');
    }
};

// ======== WITHDRAWAL SYSTEM ========
document.getElementById('withdraw').onclick = async () => {
    const paypal = document.getElementById('paypal').value;
    
    if (!validateEmail(paypal)) {
        showMessage(userMsg, "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ PayPal ØµØ­ÙŠØ­", 'error');
        return;
    }
    
    try {
        const userRef = doc(db, 'users', currentUser.uid);
        const userDoc = await getDoc(userRef);
        const balance = userDoc.data().balance || 0;
        
        if (balance < 25) {
            showMessage(userMsg, "âš ï¸ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ Ù‡Ùˆ $25. Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: $" + balance.toFixed(2), 'error');
            return;
        }
        
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø·Ù„Ø¨ Ø³Ø­Ø¨ $${balance.toFixed(2)} Ø¥Ù„Ù‰ ${paypal}ØŸ`)) {
            return;
        }
        
        showMessage(userMsg, "â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨...", 'info');
        
        await addDoc(collection(db, 'withdrawals'), {
            userId: currentUser.uid,
            userEmail: currentUser.email,
            amount: balance,
            paypal: paypal,
            status: 'pending',
            requestedAt: Timestamp.now()
        });
        
        await updateDoc(userRef, { balance: 0 });
        
        balanceEl.textContent = "0.00";
        showMessage(userMsg, "âœ… ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø© Ø¹Ù…Ù„.", 'success');
        logEvent(analytics, 'request_withdrawal', { amount: balance });
        
        loadUserWithdrawals();
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨", 'error');
    }
};

async function loadUserWithdrawals() {
    const withdrawalsDiv = document.getElementById('user-withdrawals');
    if (!withdrawalsDiv) return;
    
    try {
        const q = query(
            collection(db, 'withdrawals'),
            where('userId', '==', currentUser.uid),
            orderBy('requestedAt', 'desc'),
            limit(10)
        );
        
        const querySnapshot = await getDocs(q);
        withdrawalsDiv.innerHTML = '';
        
        if (querySnapshot.empty) {
            withdrawalsDiv.innerHTML = '<div class="info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ø³Ø§Ø¨Ù‚Ø©</div>';
            return;
        }
        
        querySnapshot.forEach(docSnap => {
            const w = docSnap.data();
            const div = document.createElement('div');
            div.className = 'task';
            
            let statusBadge = '';
            if (w.status === 'pending') {
                statusBadge = '<span class="badge badge-warning">â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>';
            } else if (w.status === 'paid') {
                statusBadge = '<span class="badge badge-success">âœ… ØªÙ… Ø§Ù„Ø¯ÙØ¹</span>';
            } else if (w.status === 'rejected') {
                statusBadge = '<span class="badge badge-danger">âŒ Ù…Ø±ÙÙˆØ¶</span>';
            }
            
            div.innerHTML = `
                <h4>Ø·Ù„Ø¨ Ø³Ø­Ø¨ #${docSnap.id.substring(0, 8)}</h4>
                <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> $${w.amount.toFixed(2)}</p>
                <p><strong>PayPal:</strong> ${w.paypal}</p>
                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${statusBadge}</p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</strong> ${w.requestedAt.toDate().toLocaleDateString('ar-SA')}</p>
                ${w.processedAt ? `<p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</strong> ${w.processedAt.toDate().toLocaleDateString('ar-SA')}</p>` : ''}
            `;
            withdrawalsDiv.appendChild(div);
        });
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨:", error);
        withdrawalsDiv.innerHTML = '<div class="error">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</div>';
    }
}

// ======== ADMIN FUNCTIONS ========
async function loadAdminData() {
    try {
        await loadAdminStats();
        await loadAdminTasks();
        await loadAdminWithdrawals();
        await loadAdminUsers();
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:", error);
    }
}

async function loadAdminStats() {
    try {
        // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        const usersSnapshot = await getDocs(collection(db, 'users'));
        document.getElementById('total-users').textContent = usersSnapshot.size;
        
        // Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©
        const tasksSnapshot = await getDocs(query(collection(db, 'tasks'), where('status', '==', 'active')));
        document.getElementById('active-tasks-count').textContent = tasksSnapshot.size;
        
        // Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        const withdrawalsSnapshot = await getDocs(query(collection(db, 'withdrawals'), where('status', '==', 'pending')));
        document.getElementById('pending-withdrawals').textContent = withdrawalsSnapshot.size;
        
        // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ²Ø¹Ø©
        let totalEarned = 0;
        const paidWithdrawals = await getDocs(query(collection(db, 'withdrawals'), where('status', '==', 'paid')));
        paidWithdrawals.forEach(doc => {
            totalEarned += doc.data().amount || 0;
        });
        document.getElementById('total-earned').textContent = `$${totalEarned.toFixed(2)}`;
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:", error);
    }
}

async function loadAdminTasks() {
    try {
        adminTasksDiv.innerHTML = '<div class="loading" style="text-align:center;padding:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…...</div>';
        
        const tasksSnapshot = await getDocs(collection(db, 'tasks'));
        adminTasksDiv.innerHTML = '';
        
        if (tasksSnapshot.empty) {
            adminTasksDiv.innerHTML = '<div class="info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯</div>';
            return;
        }
        
        tasksSnapshot.forEach(docSnap => {
            const task = docSnap.data();
            const div = document.createElement('div');
            div.className = 'admin-box';
            div.innerHTML = `
                <h4>${task.title}</h4>
                <p><strong>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©:</strong> $${task.reward?.toFixed(2) || '0.00'}</p>
                <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${task.type || 'Ø²ÙŠØ§Ø±Ø© Ù…ÙˆÙ‚Ø¹'}</p>
                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="badge ${task.status === 'active' ? 'badge-success' : 'badge-danger'}">${task.status === 'active' ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}</span></p>
                <p><strong>Ø§Ù„Ù…ÙƒØªÙ…Ù„:</strong> ${task.completed || 0} / ${task.maxUsers || 0}</p>
                ${task.url ? `<p><strong>Ø§Ù„Ø±Ø§Ø¨Ø·:</strong> <a href="${task.url}" target="_blank">${task.url.substring(0, 40)}...</a></p>` : ''}
                <div class="task-actions">
                    <button onclick="editTask('${docSnap.id}')" class="btn-primary">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                    <button onclick="deleteTask('${docSnap.id}')" class="btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    <button onclick="toggleTaskStatus('${docSnap.id}', '${task.status}')" class="${task.status === 'active' ? 'btn-warning' : 'btn-success'}" style="background: ${task.status === 'active' ? '#f39c12' : '#27ae60'}; color: white;">
                        ${task.status === 'active' ? 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù' : 'â–¶ï¸ ØªÙØ¹ÙŠÙ„'}
                    </button>
                </div>
            `;
            adminTasksDiv.appendChild(div);
        });
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù‡Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:", error);
        adminTasksDiv.innerHTML = '<div class="error">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…</div>';
    }
}

window.editTask = async (taskId) => {
    alert("Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±. Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø±ÙŠØ¨.");
};

window.deleteTask = async (taskId) => {
    if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ")) return;
    
    try {
        await deleteDoc(doc(db, 'tasks', taskId));
        await loadAdminTasks();
        showMessage(userMsg, "âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­", 'success');
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©", 'error');
    }
};

window.toggleTaskStatus = async (taskId, currentStatus) => {
    try {
        const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
        await updateDoc(doc(db, 'tasks', taskId), { status: newStatus });
        await loadAdminTasks();
        showMessage(userMsg, `âœ… ØªÙ… ${newStatus === 'active' ? 'ØªÙØ¹ÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù'} Ø§Ù„Ù…Ù‡Ù…Ø©`, 'success');
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©", 'error');
    }
};

async function loadAdminWithdrawals() {
    try {
        withdrawalsDiv.innerHTML = '<div class="loading" style="text-align:center;padding:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨...</div>';
        
        const pendingWithdrawals = await getDocs(query(collection(db, 'withdrawals'), where('status', '==', 'pending'), orderBy('requestedAt', 'desc')));
        const completedWithdrawals = await getDocs(query(collection(db, 'withdrawals'), where('status', '==', 'paid'), orderBy('processedAt', 'desc'), limit(10)));
        
        withdrawalsDiv.innerHTML = '';
        
        if (pendingWithdrawals.empty) {
            withdrawalsDiv.innerHTML = '<div class="info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ù…Ø¹Ù„Ù‚Ø©</div>';
        } else {
            pendingWithdrawals.forEach(docSnap => {
                const w = docSnap.data();
                const div = document.createElement('div');
                div.className = 'admin-box';
                div.innerHTML = `
                    <h4>Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ù…Ù† ${w.userEmail}</h4>
                    <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> $${w.amount.toFixed(2)}</p>
                    <p><strong>PayPal:</strong> ${w.paypal}</p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</strong> ${w.requestedAt.toDate().toLocaleString('ar-SA')}</p>
                    <div class="task-actions">
                        <button onclick="approveWithdraw('${docSnap.id}')" class="btn-success">âœ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¯ÙØ¹</button>
                        <button onclick="rejectWithdraw('${docSnap.id}')" class="btn-danger">âŒ Ø±ÙØ¶</button>
                        <button onclick="contactUser('${w.userEmail}')" class="btn-primary">âœ‰ï¸ Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
                    </div>
                `;
                withdrawalsDiv.appendChild(div);
            });
        }
        
        const completedDiv = document.getElementById('completed-withdrawals');
        if (completedDiv) {
            completedDiv.innerHTML = '';
            
            if (completedWithdrawals.empty) {
                completedDiv.innerHTML = '<div class="info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ù…ÙƒØªÙ…Ù„Ø©</div>';
            } else {
                completedWithdrawals.forEach(docSnap => {
                    const w = docSnap.data();
                    const div = document.createElement('div');
                    div.className = 'task';
                    div.innerHTML = `
                        <h4>Ø·Ù„Ø¨ Ø³Ø­Ø¨ #${docSnap.id.substring(0, 8)}</h4>
                        <p><strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${w.userEmail}</p>
                        <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> $${w.amount.toFixed(2)}</p>
                        <p><strong>PayPal:</strong> ${w.paypal}</p>
                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹:</strong> ${w.processedAt?.toDate().toLocaleString('ar-SA') || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                    `;
                    completedDiv.appendChild(div);
                });
            }
        }
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨:", error);
        withdrawalsDiv.innerHTML = '<div class="error">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</div>';
    }
}

window.approveWithdraw = async (withdrawalId) => {
    if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ ÙˆØªØ¯ÙˆÙŠÙ† Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ØŸ")) return;
    
    try {
        const withdrawRef = doc(db, 'withdrawals', withdrawalId);
        await updateDoc(withdrawRef, {
            status: 'paid',
            processedAt: Timestamp.now()
        });
        
        showMessage(userMsg, "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­", 'success');
        logEvent(analytics, 'approve_withdrawal', { withdrawal_id: withdrawalId });
        
        await loadAdminWithdrawals();
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø³Ø­Ø¨:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø³Ø­Ø¨", 'error');
    }
};

window.rejectWithdraw = async (withdrawalId) => {
    if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ Ø³ÙŠØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….")) return;
    
    try {
        const withdrawRef = doc(db, 'withdrawals', withdrawalId);
        const withdrawDoc = await getDoc(withdrawRef);
        const withdrawData = withdrawDoc.data();
        
        await updateDoc(withdrawRef, {
            status: 'rejected',
            processedAt: Timestamp.now(),
            reason: 'Ù…Ø±ÙÙˆØ¶ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'
        });
        
        const userRef = doc(db, 'users', withdrawData.userId);
        await updateDoc(userRef, {
            balance: increment(withdrawData.amount)
        });
        
        showMessage(userMsg, "âœ… ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…", 'success');
        logEvent(analytics, 'reject_withdrawal', { withdrawal_id: withdrawalId });
        
        await loadAdminWithdrawals();
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø³Ø­Ø¨:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø³Ø­Ø¨", 'error');
    }
};

window.contactUser = (email) => {
    window.location.href = `mailto:${email}?subject=Ø·Ù„Ø¨ Ø³Ø­Ø¨ - Ù…Ù†ØµØ© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¨Ø³ÙŠØ·Ø©`;
};

async function loadAdminUsers() {
    try {
        usersListDiv.innerHTML = '<div class="loading" style="text-align:center;padding:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</div>';
        
        const usersSnapshot = await getDocs(collection(db, 'users'));
        usersListDiv.innerHTML = '';
        
        if (usersSnapshot.empty) {
            usersListDiv.innerHTML = '<div class="info">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯</div>';
            return;
        }
        
        usersSnapshot.forEach(docSnap => {
            const user = docSnap.data();
            const div = document.createElement('div');
            div.className = 'user-card';
            div.id = `user-${docSnap.id}`;
            
            const joinDate = user.createdAt ? user.createdAt.toDate().toLocaleDateString('ar-SA') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const lastLogin = user.lastLogin ? user.lastLogin.toDate().toLocaleDateString('ar-SA') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            
            div.innerHTML = `
                <h4>${user.email}</h4>
                <p><strong>Ø§Ù„Ø±ØµÙŠØ¯:</strong> $${user.balance?.toFixed(2) || '0.00'}</p>
                <p><strong>Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª:</strong> ${user.referrals || 0}</p>
                <p><strong>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</strong> ${user.completedTasks || 0}</p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${joinDate}</p>
                <p><strong>Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„:</strong> ${lastLogin}</p>
                <div class="task-actions">
                    <button onclick="adjustUserBalance('${docSnap.id}')" class="btn-primary">ğŸ’° ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯</button>
                    <button onclick="viewUserTasks('${docSnap.id}')" class="btn-success">ğŸ“‹ Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
                    ${user.email !== adminEmail ? `<button onclick="deleteUser('${docSnap.id}')" class="btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>` : ''}
                </div>
            `;
            usersListDiv.appendChild(div);
        });
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:", error);
        usersListDiv.innerHTML = '<div class="error">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>';
    }
}

window.adjustUserBalance = async (userId) => {
    const newBalance = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
    if (newBalance === null || isNaN(parseFloat(newBalance))) return;
    
    try {
        await updateDoc(doc(db, 'users', userId), {
            balance: parseFloat(newBalance)
        });
        
        showMessage(userMsg, "âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­", 'success');
        await loadAdminUsers();
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯", 'error');
    }
};

window.viewUserTasks = async (userId) => {
    alert("Ù…ÙŠØ²Ø© Ø¹Ø±Ø¶ Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±. Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø±ÙŠØ¨.");
};

window.deleteUser = async (userId) => {
    if (!confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.")) return;
    
    try {
        await deleteDoc(doc(db, 'users', userId));
        showMessage(userMsg, "âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­", 'success');
        await loadAdminUsers();
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", 'error');
    }
};

function searchUsers() {
    const searchTerm = document.getElementById('search-user').value.toLowerCase();
    const userCards = document.querySelectorAll('.user-card');
    
    userCards.forEach(card => {
        const email = card.querySelector('h4').textContent.toLowerCase();
        if (email.includes(searchTerm)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

// ======== ADD TASK (ADMIN) ========
document.getElementById('add-task').onclick = async () => {
    const title = document.getElementById('task-title').value;
    const url = document.getElementById('task-url').value;
    const reward = parseFloat(document.getElementById('task-reward').value);
    const maxUsers = parseInt(document.getElementById('task-max').value);
    const type = document.getElementById('task-type').value;
    
    if (!title || !url || !reward || !maxUsers) {
        alert("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
        return;
    }
    
    if (reward <= 0) {
        alert("âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±");
        return;
    }
    
    if (maxUsers <= 0) {
        alert("âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±");
        return;
    }
    
    try {
        showMessage(userMsg, "â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©...", 'info');
        
        await addDoc(collection(db, 'tasks'), {
            title: title,
            url: url,
            reward: reward,
            type: type,
            maxUsers: maxUsers,
            completed: 0,
            status: 'active',
            createdAt: Timestamp.now(),
            description: `Ø£ÙƒÙ…Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ $${reward.toFixed(2)}`
        });
        
        // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('task-title').value = '';
        document.getElementById('task-url').value = '';
        document.getElementById('task-reward').value = '';
        document.getElementById('task-max').value = '';
        
        showMessage(userMsg, "âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!", 'success');
        logEvent(analytics, 'add_task', { reward: reward, type: type });
        
        await loadAdminTasks();
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©:", error);
        showMessage(userMsg, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©", 'error');
    }
};

// ======== CHECK REFERRAL ON LOAD ========
window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get('ref');
    
    if (refCode && currentUser) {
        document.getElementById('referral').value = refCode;
        localStorage.setItem('referralCode', refCode);
    }
    
    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙˆØ¯ Ø¥Ø­Ø§Ù„Ø© Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
    const savedRefCode = localStorage.getItem('referralCode');
    if (savedRefCode && !refCode) {
        document.getElementById('referral').value = savedRefCode;
    }
});

// ======== ØªØ­Ù„ÙŠÙ„ URL Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ========
function checkUrlHash() {
    if (window.location.hash === '#tasks') {
        showUserTab('tasks');
    } else if (window.location.hash === '#withdraw') {
        showUserTab('withdraw');
    } else if (window.location.hash === '#referral') {
        showUserTab('referral');
    }
}

window.addEventListener('hashchange', checkUrlHash);
window.addEventListener('load', checkUrlHash);

// ======== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ========
// Ø¥Ø¶Ø§ÙØ© ØµÙˆØª Ø¹Ù†Ø¯ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
function playSuccessSound() {
    const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');
    audio.volume = 0.3;
    audio.play().catch(e => console.log("Audio play failed:", e));
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ø±ØµÙŠØ¯
setInterval(() => {
    if (currentUser && !adminSection.style.display !== 'none') {
        loadUserData();
    }
}, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©

// Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
window.addEventListener('beforeunload', () => {
    if (currentUser && currentUser.email === adminEmail) {
        const activeTab = document.querySelector('.admin-tab.active').id.replace('admin-', '').replace('-tab', '');
        sessionStorage.setItem('adminTab', activeTab);
    } else if (currentUser) {
        const activeTab = document.querySelector('.user-tab.active').id.replace('user-', '').replace('-tab', '');
        sessionStorage.setItem('userTab', activeTab);
    }
});

// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
window.addEventListener('load', () => {
    if (currentUser) {
        setTimeout(() => {
            if (currentUser.email === adminEmail) {
                const savedTab = sessionStorage.getItem('adminTab') || 'stats';
                showAdminTab(savedTab);
            } else {
                const savedTab = sessionStorage.getItem('userTab') || 'tasks';
                showUserTab(savedTab);
            }
        }, 1000);
    }
});
</script>
</body>
</html>